<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mídia - I.E.P.C</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="container">
            <a href="index.html" class="logo">I.E.P.C</a>
            <nav>
                <ul>
                    <li><a href="midia.html">Mídia</a></li>
                    <li><a href="index.html">Início</a></li>
                    <li><a href="sobre.html">Sobre Nós</a></li>
                    <li><a href="cultos.html">Cultos</a></li>
                    <li><a href="biblia.html">Bíblia</a></li>
                </ul>
            </nav>
            <button id="dark-toggle"><i class="fas fa-moon"></i></button>
        </div>
    </header>

    <section class="section">
        <div class="container">
            <h2>Mídia</h2>
            <div class="tabs">
                <button class="tab-btn active" data-tab="live">Ao Vivo</button>
                <button class="tab-btn" data-tab="fotos">Fotos</button>
                <button class="tab-btn" data-tab="videos">Vídeos</button>
            </div>
            <div id="live" class="tab-content active">
                <iframe width="100%" height="500" src="" frameborder="0" allowfullscreen id="live-frame"></iframe>
                <p id="no-live">Nenhuma transmissão ao vivo no momento.</p>
            </div>
            <div id="fotos" class="tab-content">
                <div class="gallery-grid" id="gallery"></div>
            </div>
            <div id="videos" class="tab-content">
                <div class="video-grid" id="video-list"></div>
            </div>
            <button id="adm-btn">Área ADM</button>
        </div>
    </section>

    <div id="adm-panel" class="adm-panel">
        <h3>Área Administrativa</h3>
        <button id="adm-close" style="position:absolute; top:10px; right:10px; background:none; border:none; color:white; font-size:2rem; cursor:pointer;">×</button>
        <input type="password" id="adm-password" placeholder="Senha">
        <button id="adm-login">Entrar</button>
        <div id="adm-content" style="display:none;">
            <h4>Live YouTube</h4>
            <input type="text" id="live-link" placeholder="Link embed (ex: https://www.youtube.com/embed/ID)">
            <button id="save-live">Salvar Live</button>
            
            <h4>Adicionar Foto</h4>
            <input type="text" id="foto-url" placeholder="URL da imagem">
            <button id="add-foto">Adicionar Foto</button>
            
            <h4>Adicionar Vídeo do YouTube</h4>
            <input type="text" id="video-url" placeholder="Link embed (ex: https://www.youtube.com/embed/ID)">
            <input type="text" id="video-title" placeholder="Título do vídeo">
            <button id="add-video">Adicionar Vídeo</button>
            
            <h4>Remover</h4>
            <button id="remove-all" style="background:#c2185b; color:white;">Limpar Tudo</button>
        </div>
    </div>

    <a href="index.html" class="back-home"><i class="fas fa-home"></i></a>
    <button id="topo"><i class="fas fa-arrow-up"></i></button>

    <script src="script.js"></script>
    <script>
        // Config GitHub
        const GITHUB_TOKEN = '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';
        const REPO = 'iepc1/Fazenda-iepc';
        const FILE_PATH = 'data.json';

        // Carrega os dados
        async function loadData() {
            try {
                const response = await fetch(`https://raw.githubusercontent.com/\( {REPO}/main/ \){FILE_PATH}?t=${new Date().getTime()}`);
                const content = await response.json();

                // Live
                if (content.live) {
                    document.getElementById('live-frame').src = content.live;
                    document.getElementById('no-live').style.display = 'none';
                }

                // Fotos
                const gallery = document.getElementById('gallery');
                gallery.innerHTML = '';
                content.fotos.forEach(url => {
                    const img = document.createElement('img');
                    img.src = url;
                    gallery.appendChild(img);
                });

                // Vídeos
                const videoList = document.getElementById('video-list');
                videoList.innerHTML = '';
                content.videos.forEach(v => {
                    const p = document.createElement('p');
                    p.textContent = v.title;
                    const iframe = document.createElement('iframe');
                    iframe.src = v.url;
                    iframe.width = '100%';
                    iframe.height = '315';
                    iframe.allowFullscreen = true;
                    videoList.appendChild(p);
                    videoList.appendChild(iframe);
                });
            } catch (e) {
                console.log('Carregando...');
            }
        }

        // Salva no GitHub
        async function saveData(newData) {
            const response = await fetch(`https://api.github.com/repos/\( {REPO}/contents/ \){FILE_PATH}`);
            const file = await response.json();
            const sha = file.sha;

            await fetch(`https://api.github.com/repos/\( {REPO}/contents/ \){FILE_PATH}`, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${GITHUB_TOKEN}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: 'Atualização Mídia I.E.P.C',
                    content: btoa(unescape(encodeURIComponent(JSON.stringify(newData)))),
                    sha: sha
                })
            });
            loadData();
        }

        // Área ADM
        const admBtn = document.getElementById('adm-btn');
        const admPanel = document.getElementById('adm-panel');
        const admClose = document.getElementById('adm-close');
        const admPassword = document.getElementById('adm-password');
        const admLogin = document.getElementById('adm-login');
        const admContent = document.getElementById('adm-content');

        admBtn.addEventListener('click', () => {
            admPanel.style.display = 'block';
        });

        admClose.addEventListener('click', () => {
            admPanel.style.display = 'none';
        });

        admLogin.addEventListener('click', () => {
            if (admPassword.value === 'IEPC') {
                admContent.style.display = 'block';
            } else {
                alert('Senha incorreta!');
            }
        });

        // Salvar Live
        document.getElementById('save-live').addEventListener('click', async () => {
            const link = document.getElementById('live-link').value.trim();
            if (link) {
                const response = await fetch(`https://raw.githubusercontent.com/\( {REPO}/main/ \){FILE_PATH}`);
                const content = await response.json();
                content.live = link;
                await saveData(content);
            }
        });

        // Adicionar Foto
        document.getElementById('add-foto').addEventListener('click', async () => {
            const url = document.getElementById('foto-url').value.trim();
            if (url) {
                const response = await fetch(`https://raw.githubusercontent.com/\( {REPO}/main/ \){FILE_PATH}`);
                const content = await response.json();
                content.fotos.push(url);
                await saveData(content);
                document.getElementById('foto-url').value = '';
            }
        });

        // Adicionar Vídeo
        document.getElementById('add-video').addEventListener('click', async () => {
            const url = document.getElementById('video-url').value.trim();
            const title = document.getElementById('video-title').value.trim() || 'Sermão';
            if (url) {
                const response = await fetch(`https://raw.githubusercontent.com/\( {REPO}/main/ \){FILE_PATH}`);
                const content = await response.json();
                content.videos.push({url, title});
                await saveData(content);
                document.getElementById('video-url').value = '';
                document.getElementById('video-title').value = '';
            }
        });

        // Limpar tudo
        document.getElementById('remove-all').addEventListener('click', async () => {
            if (confirm('Limpar tudo?')) {
                await saveData({live: '', fotos: [], videos: []});
            }
        });

        // Carrega ao abrir e a cada minuto
        loadData();
        setInterval(loadData, 60000);
    </script>
</body>
</html>