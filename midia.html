<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mídia - I.E.P.C</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="container">
            <a href="index.html" class="logo">I.E.P.C</a>
            <nav>
                <ul>
                    <li><a href="midia.html">Mídia</a></li>
                    <li><a href="index.html">Início</a></li>
                    <li><a href="sobre.html">Sobre Nós</a></li>
                    <li><a href="cultos.html">Cultos</a></li>
                    <li><a href="biblia.html">Bíblia</a></li>
                </ul>
            </nav>
            <button id="dark-toggle"><i class="fas fa-moon"></i></button>
        </div>
    </header>

    <section class="section">
        <div class="container">
            <h2>Mídia</h2>
            <div class="tabs">
                <button class="tab-btn active" data-tab="live">Ao Vivo</button>
                <button class="tab-btn" data-tab="fotos">Fotos</button>
                <button class="tab-btn" data-tab="videos">Vídeos</button>
            </div>
            <div id="live" class="tab-content active">
                <iframe width="100%" height="500" src="" frameborder="0" allowfullscreen id="live-frame"></iframe>
                <p id="no-live">Nenhuma transmissão ao vivo no momento.</p>
            </div>
            <div id="fotos" class="tab-content">
                <div class="gallery-grid" id="gallery"></div>
            </div>
            <div id="videos" class="tab-content">
                <div class="video-grid" id="video-list"></div>
            </div>
            <button id="adm-btn">Área ADM</button>
        </div>
    </section>

    <!-- Mensagem de atualização PWA -->
    <div id="update-banner" style="display:none; position:fixed; bottom:0; left:0; right:0; background:#e91e63; color:white; padding:15px; text-align:center; z-index:1000;">
        <p>Existem atualizações pendentes. Deseja atualizar agora?</p>
        <button id="update-now" style="background:white; color:#e91e63; border:none; padding:10px 20px; margin:5px; cursor:pointer;">Atualizar</button>
        <button id="update-later" style="background:transparent; color:white; border:1px solid white; padding:10px 20px; margin:5px; cursor:pointer;">Depois</button>
    </div>

    <div id="adm-panel" class="adm-panel">
        <h3>Área Administrativa</h3>
        <button id="adm-close" style="position:absolute; top:10px; right:10px; background:none; border:none; color:white; font-size:2rem; cursor:pointer;">×</button>
        <input type="password" id="adm-password" placeholder="Senha">
        <button id="adm-login">Entrar</button>
        <div id="adm-content" style="display:none;">
            <h4>Live YouTube</h4>
            <input type="text" id="live-link" placeholder="Link embed">
            <button id="save-live">Salvar Live</button>
            
            <h4>Adicionar Foto</h4>
            <input type="text" id="foto-url" placeholder="URL da imagem">
            <button id="add-foto">Adicionar Foto</button>
            
            <h4>Adicionar Vídeo</h4>
            <input type="text" id="video-url" placeholder="Link embed">
            <input type="text" id="video-title" placeholder="Título">
            <button id="add-video">Adicionar Vídeo</button>
            
            <h4>Sync em todos</h4>
            <button id="generate-sync" style="background:#28a745; color:white;">Gerar código pra sync</button>
            
            <h4>Remover</h4>
            <button id="remove-all" style="background:#c2185b; color:white;">Limpar Tudo</button>
        </div>
    </div>

    <a href="index.html" class="back-home"><i class="fas fa-home"></i></a>
    <button id="topo"><i class="fas fa-arrow-up"></i></button>

    <script src="script.js"></script>
    <script>
        // LocalStorage pra ADM
        function loadMedia() {
            const liveLink = localStorage.getItem('live-link') || '';
            if (liveLink) {
                document.getElementById('live-frame').src = liveLink;
                document.getElementById('no-live').style.display = 'none';
            }

            const gallery = document.getElementById('gallery');
            gallery.innerHTML = '';
            const fotos = JSON.parse(localStorage.getItem('fotos') || '[]');
            fotos.forEach(url => {
                const img = document.createElement('img');
                img.src = url;
                gallery.appendChild(img);
            });

            const videoList = document.getElementById('video-list');
            videoList.innerHTML = '';
            const videos = JSON.parse(localStorage.getItem('videos') || '[]');
            videos.forEach(v => {
                const p = document.createElement('p');
                p.textContent = v.title;
                const iframe = document.createElement('iframe');
                iframe.src = v.url;
                iframe.width = '100%';
                iframe.height = '315';
                iframe.allowFullscreen = true;
                videoList.appendChild(p);
                videoList.appendChild(iframe);
            });
        }

        // Salvar Live
        document.getElementById('save-live').addEventListener('click', () => {
            const link = document.getElementById('live-link').value.trim();
            if (link) {
                localStorage.setItem('live-link', link);
                loadMedia();
                alert('Live salva!');
                document.getElementById('live-link').value = '';
            }
        });

        // Adicionar Foto
        document.getElementById('add-foto').addEventListener('click', () => {
            const url = document.getElementById('foto-url').value.trim();
            if (url) {
                const fotos = JSON.parse(localStorage.getItem('fotos') || '[]');
                fotos.push(url);
                localStorage.setItem('fotos', JSON.stringify(fotos));
                loadMedia();
                alert('Foto adicionada!');
                document.getElementById('foto-url').value = '';
            }
        });

        // Adicionar Vídeo
        document.getElementById('add-video').addEventListener('click', () => {
            const url = document.getElementById('video-url').value.trim();
            const title = document.getElementById('video-title').value.trim() || 'Sermão';
            if (url) {
                const videos = JSON.parse(localStorage.getItem('videos') || '[]');
                videos.push({url, title});
                localStorage.setItem('videos', JSON.stringify(videos));
                loadMedia();
                alert('Vídeo adicionado!');
                document.getElementById('video-url').value = '';
                document.getElementById('video-title').value = '';
            }
        });

        // Gerar código pra sync
        document.getElementById('generate-sync').addEventListener('click', () => {
            const live = localStorage.getItem('live-link') || '';
            const fotos = JSON.parse(localStorage.getItem('fotos') || '[]');
            const videos = JSON.parse(localStorage.getItem('videos') || '[]');

            const data = {
                live: live,
                fotos: fotos,
                videos: videos
            };

            const jsonString = JSON.stringify(data, null, 2);
            prompt('Copie e cole no data.json no GitHub:', jsonString);
        });

        // Limpar tudo
        document.getElementById('remove-all').addEventListener('click', () => {
            if (confirm('Limpar tudo?')) {
                localStorage.removeItem('live-link');
                localStorage.removeItem('fotos');
                localStorage.removeItem('videos');
                loadMedia();
                alert('Tudo limpo!');
            }
        });

        // Área ADM (close, login, abas etc – mesmo de antes)

        // PWA atualização automática
        let newWorker;
        const updateBanner = document.getElementById('update-banner');
        const updateNow = document.getElementById('update-now');
        const updateLater = document.getElementById('update-later');

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').then(reg => {
                reg.addEventListener('updatefound', () => {
                    newWorker = reg.installing;
                    newWorker.addEventListener('statechange', () => {
                        if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                            updateBanner.style.display = 'block';
                        }
                    });
                });
            });

            updateNow.addEventListener('click', () => {
                if (newWorker) {
                    newWorker.postMessage({action: 'skipWaiting'});
                }
            });

            updateLater.addEventListener('click', () => {
                updateBanner.style.display = 'none';
            });

            navigator.serviceWorker.addEventListener('controllerchange', () => {
                window.location.reload();
            });
        }

        loadMedia();
    </script>
</body>
</html>